# Bidirectional Normalizing Flow: From Data to Noise and Back

## 基本情報
- **arXiv ID**: 2512.10953v1 (https://arxiv.org/abs/2512.10953)
- **著者**: Yiyang Lu, Qiao Sun, Xianbang Wang, Zhicheng Jiang, Hanhong Zhao, Kaiming He
- **所属**: MIT, Tsinghua University
- **投稿日**: 2025年12月14日
- **カテゴリ**: cs.LG, cs.AI

## 簡単に説明すると
この論文は、正規化フロー（Normalizing Flow）における長年の制約である「逆過程が順過程の厳密な解析的逆変換でなければならない」という仮定に挑戦し、BiFlowという新しいフレームワークを提案している。BiFlowでは順過程と逆過程を別々に学習させることで、より柔軟なアーキテクチャの使用が可能になり、推論速度を最大2桁向上させながら生成品質も改善することに成功している。ImageNet 256×256でFID 2.39を達成し、NF系手法の中で最先端の結果を記録している。現在のコードやデモの公開状況については論文中に明記されていない。

## 1. 研究概要
### 1.1 背景と動機
正規化フロー（NF）は生成モデルの原理的なフレームワークとして長年確立されてきた。従来のNFは、データをノイズに変換する順過程（forward process）と、その逆変換によってサンプルを生成する逆過程（reverse process）の2つから構成される。NFの特筆すべき性質は、データからノイズへのフロー軌跡が学習されることであり、これは軌跡が事前に決定されるFlow Matchingなどの現代的な連続時間対応手法とは異なる。

しかし、この利点は学習の困難さという代償を伴い、通常は順過程アーキテクチャと目的関数の定式化に対してより厳しい制約をもたらす。標準的なNFパラダイムでは、逆過程が順過程の厳密な解析的逆変換である必要があり、この要件により使用可能な順モデルアーキテクチャの範囲が制限される。モデルは明示的に可逆でなければならず、ヤコビアン行列式が計算可能、扱いやすく、微分可能でなければならない。

最近、TARFlowとその拡張によりNFと他の生成モデルとのギャップが大幅に縮小された。TARFlowはTransformerと自己回帰フローをNFパラダイムに効果的に統合し、NFメソッドが強力なTransformerの恩恵を受けることを可能にした。しかし、計算可能で扱いやすいヤコビアン行列式を維持するため、TARFlowは順過程を長い連鎖（数千ステップ）の自己回帰操作に分解する。その結果、明示的逆変換は推論時に大量の因果ステップを必要とし、並列化が困難になる。

### 1.2 主要な貢献
本研究では双方向正規化フロー（BiFlow）というフレームワークを導入し、順過程と逆過程の両方を学習する。このフレームワークでは、順過程と逆過程の設計が分離されており、順過程は計算可能で扱いやすく学習しやすい任意のNFモデルにでき、逆過程はその逆変換を近似する別のモデルを学習する。

- 厳密な解析的逆変換の必要性を排除し、学習可能な逆モデルによる正規化フローの概念的革新
- Hidden Alignmentを含む3つの逆過程学習戦略の提案：より柔軟なアーキテクチャと表現を可能にする手法
- スコアベースノイズ除去の統合による単一ステップ生成の実現：推論コストを大幅に削減
- ImageNet 256×256でのFID 2.39達成：NF系手法の最先端性能と2桁の推論速度向上の両立

学習可能な逆モデルは単なる蒸留ではなく、事前訓練された順モデルの明示的逆変換を上回る性能を実現できる。中間隠れ状態の整列により、明示的逆変換よりも優れた結果を得ることができ、学習可能な逆モデルはTARFlowのスコアベースノイズ除去の追加ステップを自然に排除し、推論を簡素化・高速化しながら品質を向上させる。

## 2. 提案手法
### 2.1 手法の概要
BiFlowは(i) データサンプルを純粋ノイズに変換する順モデルF_θと、(ii) その逆マッピングを近似し、ノイズをデータ空間に戻す学習可能な独立した逆モデルG_φの2つを持つ。訓練は2段階で実行される：最初に古典的NFと同様に最尤推定を使用して順モデルを訓練し、次に順モデルを固定したまま逆モデルを訓練してその逆マッピングを近似する。

重要なことに、逆モデルG_φは明示的可逆性によって制約されない。その結果、逆モデルを任意のアーキテクチャ（双方向注意ベースTransformerなど）と訓練目的で設計することができる。逆過程の近似学習について、naive distillation、hidden distillation、hidden alignmentという3つの戦略を検討する。

### 2.2 技術的詳細
**逆過程学習の3つの戦略：**

1. **Naive Distillation**: 直接蒸留損失L_naive(x) = D(x, x')を課す。ここでxはデータサンプル、x'=G_φ(F_θ(x))は再構成データ、Dは距離メトリック。最終出力でのみ教師情報を提供するため、純粋ノイズから1ステップで直接データへのマッピングが高度に制約不足となる。

2. **Hidden Distillation**: 順方向軌跡に沿って生成された中間隠れ状態の完全なシーケンスを活用してL_hidden(x)=Σ_i D(x^i, h^i)。逆モデルに各部変換を個別に反転するよう促すが、各中間状態x^iが入力と同じ次元を持つ必要があるため構造的制約を導入し、アーキテクチャの柔軟性を制限する。

3. **Hidden Alignment**: より柔軟な戦略で、完全な順方向軌跡からの教師情報を活用しながら、中間隠れ状態が入力空間にある必要性を緩和する。学習可能な投影ヘッド{φ_i}を導入してL_align(x) = Σ_i D(x^i, φ_i(h^i))。表現空間と入力トークン空間を分離することで、繰り返し投影による潜在的な意味歪曲を回避する。

**スコアベースノイズ除去の排除：** TARFlowなど既存の最先端NFは、ノイズ摂動分布を学習してから出力をノイズ除去する。BiFlowでは、ノイズ除去を逆モデルに直接統合することで明示的なスコアベースノイズ除去ステップを排除する。順方向軌跡をx̃からzまで延長し、その始点にクリーンデータxを追加し、ノイズ除去用の追加ブロックh^0→x'で逆モデルを拡張する。結果として、逆ネットワークはzからクリーンサンプルx'に単一パスでマッピングする。

**距離メトリック：** BiFlowの柔軟な教師あり学習フレームワークは、(i) 1-NFE生成（学習された逆モデルが単一順伝播でサンプルx'を生成）と、(ii) 明示的ペアリング（順過程がデータxとノイズz間の直接対応を確立）という2つの主要特性により、知覚損失などの豊富な意味的教師信号を可能にする。

### 2.3 新規性
本研究の革命的な新規性は、正規化フローの根本的な仮定である「逆過程が順過程の厳密な解析的逆変換でなければならない」という制約を取り除いたことにある。これまでのNF研究は、この制約を満たす複合順関数の設計に主に焦点を当てていたが、BiFlowは順過程と逆過程を完全に分離する。

技術的革新として：
1. **パラダイムシフト**: 解析的可逆写像から訓練可能な双方向システムへ、自己回帰サンプリングから完全並列化された効率的1-NFE生成へ
2. **アーキテクチャ自由度**: 逆モデルでU-NetやVision Transformerなどの汎用アーキテクチャの使用を可能にする
3. **統合ノイズ除去**: 追加の精細化ステップの必要性を排除し、逆過程内で生成とノイズ除去を統一
4. **直接生成モデル**: "What-you-see-is-what-you-get"訓練体制により、生成されたサンプルが即座に損失評価とバックプロパゲーションで利用可能

Hidden Alignmentの設計は特に優れており、完全軌跡レベル教師信号を保持しながらアーキテクチャ柔軟性と表現の豊富さの両方を維持する。この手法により、情報損失と制限された表現力を引き起こす繰り返し投影を回避している。

## 3. 実験結果
### 3.1 実験設定
実験はImageNet 256×256の条件付き生成で実施され、50,000枚の生成画像でFréchet Inception Distance（FID）とInception Score（IS）を評価した。事前訓練されたVAEトークナイザーの潜在空間で実装され、256×256画像を32×32×4潜在表現にマッピングしてモデルの入力・出力ドメインとして使用した。

BiFlowのベースラインとして、元のTARFlowにいくつかの修正を加えた改良版TARFlow（iTARFlow）を使用した。具体的には、加算条件付けを文脈内条件付けに置換し、ノルム制御戦略を適用しつつ、STARFlow特有のコンポーネント（深浅設計、デコーダ微調整、カスタマイズCFG）を省略した。この改良版は元のTARFlowに対して実質的な改善を達成し、BiFlowの強力なベースラインを確立した。

逆モデルはModern Transformer コンポーネントを持つViTバックボーンとマルチトークン文脈内条件付けを採用し、BiFlow-B/2（パッチサイズ2のベースサイズモデル、シーケンス長256）と命名された。

### 3.2 主要な結果
**逆近似学習戦略の評価：** 3つの戦略を比較した結果、naive distillationでさえ厳密逆ベースラインを上回り、学習可能な逆モデルが解析的逆の実用的で競争力のある代替手段であることが示された。Hidden distillationは情報損失により性能が劣化したが、提案されたhidden alignment手法は3つの戦略の中で最高性能を達成し、厳密逆を明確なマージンで上回った。

**主要性能指標：** BiFlow-B/2はImageNet 256×256でFID 2.39を達成し、これは改良されたTARFlowと比較して大幅な改善である。推論速度では最大2桁の高速化を実現し、TARFlowの数千ステップの自己回帰操作に対して単一評価（1-NFE）生成を可能にした。

**アブレーション研究：** 学習時CFG機構により標準CFG手法と比較して推論コストを半分に削減しながらより良いFIDを達成。学習ノイズ除去戦略は1つの追加ブロックのみでTARFlowのスコアベースノイズ除去を上回り、15.8倍のFLOPS削減を実現した。知覚距離の組み込みにより生成品質が大幅に改善された。

### 3.3 既存手法との比較
BiFlowは既存のNF系手法の中で最先端性能を達成し、単一評価（1-NFE）手法の中でも競争力のある性能を示した。特に注目すべきは、改良されたTARFlowベースラインに対する大幅な改善であり、これは順過程として同じモデルを使用していることから、逆過程学習の効果を純粋に示している。

TARFlowの明示的逆変換と比較して、BiFlowは生成品質の向上と推論速度の劇的な改善を同時に実現した。これは、学習可能な逆モデルが解析的制約から解放されることで、より表現力豊かで効率的なアーキテクチャを使用できるためである。

スケーリング行動の予備的結果も有望であり、異なる距離メトリックの下でのBiFlowの柔軟性と堅牢性を示している。VGGとConvNeXt特徴を知覚損失に使用した場合、最適誘導スケールは0.0に近く、これらの特徴がすでに強力なクラス識別情報を提供していることを示唆している。

## 4. 実用性評価
### 4.1 実装の容易性
BiFlowの実装は比較的簡単で、既存のTARFlowのような順モデルの上に構築できる。2段階訓練プロセス（順モデル訓練→逆モデル訓練）は明確で理解しやすく、既存のNFコードベースとの統合が容易である。逆モデルはViTなどの標準的なTransformerアーキテクチャを使用できるため、実装の複雑さが大幅に軽減される。

Hidden Alignmentの実装も比較的単純で、学習可能な投影ヘッドを追加するだけで済む。知覚損失やその他の柔軟な距離メトリックの統合も標準的なディープラーニングフレームワークで容易に実現できる。ただし、最適な性能を得るには、適切なハイパーパラメータ調整と距離メトリックの選択が重要になる。

### 4.2 計算効率
BiFlowの計算効率は特筆すべき点である。推論時の計算コストが最大2桁削減されるのは、1-NFE生成により数千ステップの自己回帰操作を単一の順伝播に置き換えるためである。これにより、TARFlowの因果デコーディングボトルネックが完全に解消される。

訓練時は2段階プロセスが必要だが、逆モデルの訓練は比較的高速である。順モデルが固定されているため、逆モデルの訓練は教師ありタスクとして扱うことができ、標準的な生成モデルの訓練よりも安定している。スコアベースノイズ除去の排除により、推論時のFLOPS数が15.8倍削減される。

### 4.3 応用可能性
BiFlowの応用可能性は極めて高い。1-NFE生成の実現により、リアルタイムアプリケーションや大規模デプロイメントでの使用が現実的になる。画像生成、動画生成、3D生成など、様々な生成タスクへの適用が可能である。

柔軟な距離メトリックの使用により、特定のドメインやタスクに特化したモデルの開発が容易になる。知覚損失の統合により、視覚的品質が重要なアプリケーションでの優位性を発揮できる。また、双方向学習パラダイムは他の生成モデルファミリーとの統合や、マルチモーダル生成への拡張も期待される。

研究的観点では、正規化フローの根本的な制約を取り除いたことで、この古典的なパラダイムに新たな活力を与えており、Flow MatchingなどのモダンConnuous-time手法との相乗効果も期待される。

## 5. まとめと所感
### 5.1 論文の意義
この研究は、生成モデリングの最も古く原理的な基盤の一つである正規化フローを再定義し、その境界を拡張した革命的な貢献である。「逆過程は順過程の厳密な解析的逆変換でなければならない」という長年の通念に挑戦し、この制約が不要であることを実証したことは、理論的にも実践的にも極めて重要な意義を持つ。

BiFlowは正規化フローを解析的可逆写像から訓練可能な双方向システムへ、自己回帰サンプリングから完全並列化された効率的な生成へ、暗黙的生成モデルから直接生成モデルへと押し上げた。2桁の推論速度向上と競争力のある生成品質の同時実現は、実用的なインパクトが非常に高い。

特にMIT・清華大学の共同研究として、Kaiming Heを含む著名な研究者らによる高品質な研究であり、理論的洞察と実践的実装の両面で優れたバランスを示している。正規化フローという古典的パラダイムに新たな息吹を与え、現代的な生成モデルとの競争力を回復させた点で歴史的意義がある。

### 5.2 今後の展望
BiFlowは正規化フローの新たな時代の幕開けを告げる研究として、多くの発展可能性を秘めている。まず、他の生成タスク（動画、3D、音声）への拡張が自然な発展方向である。特に、1-NFE生成の利点は時系列や高次元データにおいてより顕著になる可能性がある。

技術的には、Hidden Alignmentの概念を他の学習パラダイムに適用することで、より一般的な「軌跡整列」フレームワークの開発が期待される。また、現在は2段階訓練だが、end-to-endでの同時最適化や、順過程と逆過程の共進化的学習も興味深い研究方向である。

Flow Matchingなどの連続時間手法との統合により、事前スケジュールされた軌跡と学習された軌跡の利点を組み合わせたハイブリッド手法の開発も有望である。著者らが示唆するように、これらの関連手法間の潜在的相乗効果の探求は重要な研究領域となるだろう。

実用的観点では、より大規模なデータセットでのスケーリング、多様なドメインでの評価、産業応用での展開などが期待される。また、知覚損失の統合成功は、他の意味的損失関数の探求への道を開いており、人間の知覚に より良く整合した生成モデルの開発につながる可能性がある。

この研究は、古典的な手法に現代的な機械学習の洞察を適用することで革新を生み出した優れた例であり、他の確立された分野でも同様のパラダイムシフトが期待される。正規化フローの復活と発展に大きく貢献する重要な一歩として位置づけられる。
