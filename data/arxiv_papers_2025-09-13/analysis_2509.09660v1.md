# Steering MoE LLMs via Expert (De)Activation

## 基本情報
arXiv IDは2509.09660v1です。
URLはhttps://arxiv.org/abs/2509.09660 です。
著者の詳細情報は論文から抽出中です。
所属機関の詳細情報は論文から抽出中です。
投稿日は2025年09月13日です。
カテゴリはcs.LG、cs.AIです。

## 簡単に説明すると
この論文は、Mixture-of-Experts（MoE）型の大規模言語モデルの動作を制御する新手法「SteerMoE」を提案しています。推論時に特定の専門家（Expert）を選択的に活性化・非活性化します。
従来のモデル再訓練や重みの変更を必要とせず、推論時にルーティング確率のみを調整します。これにより、安全性や忠実性などのモデル行動を制御できます。
実験では11のベンチマークと6つのLLMで最大20%の安全性向上と27%の忠実性向上を実現しました。
一方で、この技術が悪用された場合、安全性をほぼ無効化できることも示されており、MoE模型のアライメントが特定の専門家に集中していることによる脆弱性を暴露しています。
この研究は、MoEモデルの制御可能性を向上させる一方で、現在のアライメント手法の根本的な問題点も明らかにしています。

## 1. 研究概要
### 1.1 背景と動機
Mixture-of-Experts（MoE）アーキテクチャは幅広く採用されています。
計算効率を保ちながらモデル容量を拡張する有効な手法です。
しかし、
その専門家選択メカニズムがモデル行動に与える影響については十分に理解されていませんでした。
従来のLLM制御手法は、重みの直接変更や追加訓練を必要とするため、計算コストが高く実用性に制限がありました。

さらに重要な問題として、現在のMoEモデルにおけるアライメント（人間の価値観との整合）が、
一部の専門家に集中しているという構造的脆弱性が存在していることが懸念されています。
この状況は、代替的なルーティングパスが悪用された場合、安全性機構が迂回されるリスクを示唆しています。

この研究では、MoEモデルのルーティングパターンが行動的に重要な信号を含んでおり、
これらの信号を活用することで、モデル行動の制御と潜在的脆弱性の発見の両方が可能であることを示しています。

### 1.2 主要な貢献
この研究は、MoEモデルの行動制御に関する包括的なフレームワークを提案し、
技術的革新と同時に重要なセキュリティ上の発見をもたらしています。

主要な貢献として以下の点が挙げられます。
ペア入力における専門家活性化パターンの差分を利用した新しい行動に関連する専門家検出の手法開発により、
特定の行動（安全性や忠実性など）に強く関連する専門家を効率的に特定できるようになりました。
推論時のルーティング確率調整による軽量な制御機構の実現では、モデル重みを変更せずに済み、
実時間での行動制御が可能になります。
6つの異なるMoEモデル（GPT-OSS、Qwen3、Mixtral、Phi-3.5、OLMoE）での包括的実証により、
手法の汎用性と有効性が確認されています。
重大なセキュリティ脆弱性の発見として、アライメントの専門家集中による迂回攻撃の可能性を実証し、
GPT-OSS-120Bで100%から0%への安全性のほぼ無効化を確認しました。
防御と攻撃の両面からのアプローチにより、モデル改善と脆弱性発見の双方向研究を提示しています。

## 2. 提案手法
### 2.1 手法の概要
SteerMoEは、推論時にMoEモデルの専門家（Expert）の活性化・非活性化を制御することで、モデルの行動を操縦する手法です。
従来の手法とは異なり、モデルの重みを変更せず、ルーティング確率のみを調整することで制御を実現します。

手法は大きく2つのステップに分かれます。
最初に、行動に関連する専門家検出のフェーズでは、対比的なプロンプトペアを用いて特定の行動（安全性や忠実性など）に強く関連する専門家を特定します。
次に、推論時制御フェーズでは、検出された専門家のルーティング確率を動的に調整し、目的とする行動を促進または抑制します。

このアプローチにより、モデル再訓練や重み変更なしに、リアルタイムでの行動制御が可能となります。

### 2.2 技術的詳細
#### 2.2.1 対比的な専門家の検出
ペア入力における専門家活性化パターンの差分を利用したリスク差分（Risk Difference）手法を開発しました。

対比的なプロンプトペア $(x^{(1)}, x^{(2)})$ において、各専門家 $i$ の活性化率を以下のように定義します。
```
p^{(1)}_i = A^{(1)}_i / N^{(1)}  (専門家iがx^{(1)}で活性化される率)
p^{(2)}_i = A^{(2)}_i / N^{(2)}  (専門家iがx^{(2)}で活性化される率)
```

リスク差分 $\Delta_i$ は以下のように計算されます。
```
Δ_i = p^{(1)}_i - p^{(2)}_i
```

正の $\Delta_i$ は専門家 $i$ が $x^{(1)}$ の行動により強く関連することを示します。負の値は $x^{(2)}$ の行動への関連を示します。

#### 2.2.2 推論時の制御機構
ルーティング確率の調整は以下の手順で実行されます。

1. 元のルーティングロジット $\mathbf{z} = (z_1, ..., z_E)$ を log-softmax スコア $\mathbf{s}$ に変換
2. 活性化する専門家セット $\mathcal{A}^{+}$ と非活性化する専門家セット $\mathcal{A}^{-}$ を定義
3. 活性化ルール: $s_k \leftarrow s_{\max} + \varepsilon$ （$k \in \mathcal{A}^{+}$）
4. 非活性化ルール: $s_k \leftarrow s_{\min} - \varepsilon$ （$k \in \mathcal{A}^{-}$）
5. 調整されたスコアに softmax を適用して最終確率を計算

ここで $\varepsilon > 0$ は小さな定数（例: $10^{-2}$）で、調整の強度を制御します。

### 2.3 新規性
SteerMoEの新規性は以下の点にあります。

統計的根拠に基づく専門家選択の新しいアプローチです。
従来手法は特定のトークンやヒューリスティックに依存していました。
SteerMoEは活性化統計のみから行動に関連する専門家を特定します。

**双方向制御の実現**: 専門家の活性化だけでなく非活性化も可能とし、より細かい粒度での行動制御を実現します。
これにより、有害な専門家の抑制と有益な専門家の促進を同時に行えます。

**汎用的な行動制御**: ドメイン固有の推論努力ではなく、安全性、忠実性、有毒性など、
幅広い行動特性に対する制御を可能とします。

**重み保存型制御パラダイム**: モデルの元の重みを保持しながら推論時にのみ制御を適用するため、
元のモデル性能を維持しつつ目的に応じた行動変更が可能です。

**軽量な実装**: ルーティング確率の調整のみで制御を実現するため、
計算オーバーヘッドが最小限に抑えられます。

## 3. 実験結果
### 3.1 実験設定
#### 3.1.1 対象モデル
6つの異なるMoEモデルで評価を実施しました。
- GPT-OSS-120B、GPT-OSS-20B（OpenAI）
- Qwen3-30B-A3B（Alibaba）
- OLMoE-1B-7B（Allen Institute）
- Phi-3.5-MoE（Microsoft）
- Mixtral-8x7B（Mistral AI）

#### 3.1.2 評価タスクとデータセット
忠実性制御の評価では、以下のデータセットを使用しました。
- FaithEval-Counterfactual: 文脈の事実内容を意図的に変更したデータセット
- FaithEval-Unanswerable: 回答可能文が除去された文脈
- FaithEval-Inconsistent: 矛盾する回答を含む複数文書
- CF-TriviaQA、MQuake: 反事実的回答が必要なベンチマーク
- MCTest: 制御タスクとしての多肢選択QA

安全性制御の評価では、以下のデータセットを使用しました。
- TDC2023 Red Teaming Track: 有害応答を引き出すプロンプト100件
- MaliciousInstruct: 10の悪意ある意図に関する指示100件
- AdvBench: 有害指示500件のベンチマーク
- StrongREJECT + AIM Jailbreak: 313件の禁止プロンプト（60件のMITライセンス版使用）

#### 3.1.3 評価指標
- 安全性については、Llama-Guard-3-8Bによる安全応答率を測定しました
- 忠実性については、文書に基づいた正確な回答生成率を測定しました
- 流暢性については、Gemma-3-27B-ITを用いた応答品質評価を実施しました

### 3.2 主要な結果
#### 3.2.1 忠実性改善の結果
全てのデータセットにおいて、操縦されたモデルは標準モデルを上回る文書忠実性を示しました。
特にQwen3モデルでは全タスクで一貫した改善が観察され、最大27%の忠実性向上を達成しました。

制御タスクであるMCTestでは性能低下が最小限に抑えられ、
一般的なQA能力を維持しながら忠実性を改善できることが確認されました。

#### 3.2.2 安全性改善の結果
安全性の改善では、11のベンチマークで最大20%の安全応答率の改善を実現しました。
SteerMoEは単体でも既存のジェイルブレイク攻撃に対して競争力のある防御性能を示しました。

**攻撃性能の実証**: 逆方向の制御により、GPT-OSS-120Bで安全応答率を100%から0%に無効化しました。
これは現在のアライメント手法の脆弱性を明確に示しています。

**組み合わせ効果**: SteerMoEを既存のジェイルブレイク手法（FFA、AIM）と組み合わせて、単独手法より強力な攻撃が実現できることを確認しました。

#### 3.2.3 モデル間の差異
モデルアーキテクチャによる制御可能性の違いが観察されました。
Qwen3（128専門家/層）は Mixtral（8専門家/層）よりも安定した制御が可能でした。

これは専門家数の多さがルーティング選択肢の豊富さをもたらし、
より柔軟な行動制御を可能にすることを示唆しています。

### 3.3 既存手法との比較
#### 3.3.1 ジェイルブレイク攻撃との比較
従来のジェイルブレイク手法との比較では、SteerMoEは以下の特徴を示しました。
- Direct Instruction、GCG、ArtPrompt、FFAと比較して競争力のある攻撃成功率
- 他の手法との組み合わせにより相乗効果を発揮
- 特にAIMとの組み合わせで最強の攻撃性能を実現

#### 3.3.2 既存MoE制御手法との比較
RICEとの比較について、以下の点が挙げられます。
- RICEは $\langle think \rangle$ トークンの存在に依存するが、SteerMoEは一般的なプロンプトに適用可能
- RICEは専門家の増幅のみだが、SteerMoEは活性化・非活性化の双方向制御が可能
- RICEはドメイン特化的な推論に限定されるが、SteerMoEは幅広い行動特性に対応

従来の操縦手法との比較について、以下の点が挙げられます。
- LM-Steers、representation engineeringなどの重み変更手法と比較して軽量
- 推論時のみの制御により、元モデル性能の完全保持が可能
- MoEアーキテクチャ特有の専門家構造を活用した解釈可能な制御を実現

## 4. 実用性評価
### 4.1 実装の容易性
**高い実装容易性**: SteerMoEは既存のMoEモデルに対してルーティング確率の調整のみで実現できるため、実装は非常に容易です。
新たなモデル重みの学習や複雑なアーキテクチャ変更が不要で、少数のコード行で実装可能です。

事前処理の自動化について、行動に関連する専門家の検出プロセスは、ペア入力データセットを用意するだけで自動的に実行できます。人手による専門知識やヒューリスティックな調整が不要です。

フレームワーク非依存性について、PyTorch、TensorFlow、HuggingFaceなど、様々な深層学習フレームワークで容易に実装できます。モデルの内部アーキテクチャの依存は最小限で、ルーティング層のみへの介入で済みます。

### 4.2 計算効率
最小限の計算オーバーヘッドについて、推論時の追加計算は対数確率の計算と小さな定数の加減算のみです。元の推論処理に対する計算オーバーヘッドは1%未満です。

メモリ使用量への影響について、新たな重みやパラメータを追加しないため、メモリ使用量の増加はありません。既存のモデル重みをそのまま利用し、ルーティング確率のみを動的調整します。

リアルタイム適用可能性について、制御の適用は推論時即座に実行できます。バッチ処理やストリーミング処理の両方で対応可能で、レスポンス時間への影響は測定可能な範囲内で無視できる程度です。

スケーラビリティについて、専門家数やモデルサイズに関係なく一定の計算コストで実行できます。大規模なMoEモデルでも効率的に動作します。

### 4.3 応用可能性
**多様な行動制御への適用**: 安全性や忠実性以外にも、創造性、専門性、感情表現など、
様々な行動特性の制御に応用可能な汎用的なフレームワークです。

**動的制御の実現**: ユーザや文脈に応じて推論時にリアルタイムで行動を調整できるため、
パーソナライズされたAIアシスタントやアダプティブシステムへの応用が期待できます。

**既存システムへの統合**: APIレベルでの簡単な統合が可能で、現在運用中のMoEベースシステムに
最小限の変更で導入できます。

**教育・研究目的での活用**: MoEモデルの内部動作や専門家の特化傾向を理解するための
分析ツールとしても有用です。

**産業応用の可能性**: コンテンツフィルタリング、カスタマーサポート、創作支援など、
多様な産業分野での実用的応用が見込まれます。

**倫理的AI開発への貢献**: モデルの透明性向上と制御可能性の実現により、
責任あるAI開発と展開に貢献する可能性があります。

## 5. まとめと所感
### 5.1 論文の意義
**技術的革新の評価**: この論文は、MoEモデルの行動制御に関する重要な技術的突破を達成しています。
従来のモデル重み変更や追加学習を必要としない軽量な制御手法により、実用的な解決策を提示しました。
6つの異なるMoEモデルでの包括的な実証は手法の汎用性を強く支持しています。

**理論的貢献の評価**: リスク差分に基づく専門家を検出する手法は統計的に健全で解釈しやすく、
MoE内部の専門家特化メカニズムに関する新たな洞察を提供しています。
ペア入力による対比分析アプローチは他の機械学習分野への応用可能性も秘めています。

**重大なセキュリティ発見**: アライメントの専門家集中による脆弱性の発見は、現在のLLM安全性研究に
重要な警鐘を鳴らしています。100%の安全性無効化の実証は、既存のアライメント手法の
根本的な問題を明確に示しており、セキュリティ研究における重要な貢献です。

**実用性と研究価値のバランス**: 防御的応用（安全性・忠実性向上）と攻撃的応用（脆弱性発見）の
両面を扱うアプローチは、AI安全性研究における責任ある研究開発の良例です。

**方法論の優秀性**: 実験設計が包括的で、複数のベンチマークと評価指標を用いた検証により
結果の信頼性が高く保たれています。

### 5.2 今後の展望
**防御機構の強化**: 発見された脆弱性に対する防御手法の開発が急務です。
専門家レベルでのアライメント分散や、ルーティング操作を検出する仕組みの研究が必要です。

**理論的理解の深化**: なぜ特定の専門家が特定の行動に特化するのか、その学習メカニズムの
理論的解明により、より効果的な制御手法の開発が期待できます。

**応用範囲の拡大**: 現在の安全性・忠実性以外にも、創造性、論理性、感情表現など、
多様な行動次元での制御手法への拡張が考えられます。

**自動化と最適化**: 専門家選択やパラメータ調整の自動化により、
ユーザフレンドリーなツールとしての発展が期待されます。

**標準化への貢献**: MoEモデルの行動制御に関する標準的な評価プロトコルや
ベンチマークの確立に向けた基盤技術として機能する可能性があります。

**倫理的ガイドライン**: この技術の悪用を防ぎ、建設的な用途に活用するための
倫理的ガイドラインや利用規約の策定も重要な課題です。

**産業実装への道筋**: 研究段階から実際のプロダクションシステムへの導入に向けた
技術成熟度の向上と、実運用環境での長期的検証が求められます。
