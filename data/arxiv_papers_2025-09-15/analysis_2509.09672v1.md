# Locality in Image Diffusion Models Emerges from Data Statistics

## 基本情報
- **arXiv ID**: 2509.09672v1 (https://arxiv.org/abs/2509.09672)
- **著者**: Artem Lukoianov, Chenyang Xu, Vince Liu, Ishaan Preetam Chandratreya（複数機関の共同研究）
- **所属**: スタンフォード大学およびその他の研究機関
- **投稿日**: 2025年09月15日
- **カテゴリ**: cs.CV, cs.LG

## 簡単に説明すると
この論文は、画像拡散モデルにおける「局所性」（ある画素のデノイジング時に、その周辺の画素のみが影響するという性質）が、
従来考えられていたニューラルネットワーク・アーキテクチャの帰納的バイアスによるものではなく、
訓練データの統計的性質から自然に創発することを示している。具体的には、データの主成分分析における
信号対雑音比（SNR）の高い成分への射影として、学習された感度場が理解できることを理論的・実証的に示している。
CIFAR10のような高い自己類似性を持つデータセットでは局所的なパターンが現れるが、CelebA-HQのような
顔画像データセットでは目の間の相関など非局所的な感度が学習されることを実証し、
ウィーナーフィルターとの関連性を確立している。これまでの最適デノイザーベースの解析手法を上回る性能を示し、
拡散モデルの理論的理解に重要な洞察を提供している。

## 1. 研究概要
### 1.1 背景と動機
拡散モデルの理論的理解において、訓練目的の解析的解である「最適デノイザー」と実際の深層拡散モデルの
出力の間に顕著な乖離が存在するという根本的なパラドックスが指摘されている。最適デノイザーは
訓練データセットのみに基づく非パラメトリックな閉形式解として表現でき、理論的には完璧だが、
実際には訓練データの完全な「記憶」を示し、新規画像の生成に失敗する。

これまでの研究では、この乖離の原因として、畳み込みニューラルネットワークのアーキテクチャが持つ
並進等変性と局所性バイアスが挙げられていた。Kamb and Ganguli の研究では、局所性制約を最適デノイザーに
追加することで深層拡散モデルに近い結果を得られることを示したが、局所性の程度を第一原理から
予測できず、訓練済みUNetの受容野を測定してパッチサイズを経験的に決定する必要があった。

さらに、Transformerなど明示的な局所性や並進等変性バイアスを持たないアーキテクチャでも
同様に新規画像を生成できる事実や、U-Netが通常は画像全体をカバーする受容野を持つという
矛盾も理論の限界を示していた。これらの問題は、局所性がアーキテクチャではなく、
より根本的な原理に由来する可能性を示唆していた。

### 1.2 主要な貢献
本研究は拡散モデルの理論的理解における重要なパラダイムシフトを提供する4つの主要な貢献を行っている。

- **データ統計からの局所性の導出**: 画像拡散モデルにおける局所性が、ニューラルネットワーク・アーキテクチャの
  特性ではなく、訓練データの統計的性質から直接導出できることを初めて実証した。データの主成分分析、
  特にその信号対雑音比（SNR）の解析により、異なるアーキテクチャで学習された感度場が、
  高SNRの主成分への射影演算子として理解できることを示している。

- **最適線形フィルターとの理論的関連の確立**: 空間感度をウィーナーフィルターとして理論的に導出し、
  これが訓練データの関数として解析的に計算できることを示した。この理論的フレームワークにより、
  CIFAR10では局所的パターンが、CelebA-HQでは目の間の相関のような非局所的感度が現れる理由を
  統一的に説明できる。

- **解析的拡散モデルの定量的ベンチマークの確立**: 解析的拡散モデルがUNetの予測をどの程度説明できるかを
  測定する定量的ベンチマークを確立し、驚くべきことに、従来の最適デノイザーベースの手法が
  単純な最適線形フィルターに劣ることを実証した。これにより、拡散モデルの性能評価における
  新しい標準を提供している。

- **改良された解析的拡散モデルの提案**: 解析的に計算された局所性をKamb and Ganguli のモデルに統合し、
  CIFAR10、AFHQv2、CelebA-HQなど複数のデータセットで既存の解析的手法を上回る最高性能を達成した。
  これにより、従来は経験的に決定していたハイパーパラメータを排除し、理論的に根拠のある
  完全に解析的な拡散モデルを実現している。

## 2. 提案手法
### 2.1 手法の概要
本研究の核心は、拡散モデルにおける局所性を、ニューラルネットワークの構造的制約ではなく、
訓練データの統計的性質から導出するという根本的なアプローチの転換にある。

手法の出発点は、最適デノイザーの解析にある。拡散モデルの訓練目的を最小化する最適デノイザー
f̂(x, t) = E[x₀ | xₜ=x] は、有限の経験的データ分布に対して閉形式で表現できるが、
雑音レベルがゼロに近づくと最近傍探索となり、訓練データの記憶のみを行う。

著者らは、この問題を「サンプリング空隙」の概念で理解する。低雑音領域では、テスト画像周辺の
領域が訓練サンプルで十分にカバーされず、ニューラルネットワークデノイザーは不適切に定義された
問題を学習する。この空隙を埋めるため、線形デノイザー（ウィーナーフィルター）の観点から
拡散モデルの挙動を理解し、データの主成分における高SNR成分への射影として感度場を導出する。

具体的には、データ共分散行列の固有ベクトル分解を通じて、高SNR成分に対応する主成分方向での
「パススルー」挙動と、低SNR成分での雑音除去挙動の組み合わせとして、拡散モデルの感度を
理論的に予測する。

### 2.2 技術的詳細
理論的枠組みの中核は、最適線形デノイザーとしてのウィーナーフィルターの導出にある。

**ウィーナーフィルターの定式化**: 訓練データの経験的共分散行列をΣ、雑音分散をσₜ²として、
ウィーナーフィルターは W_t = Σ(Σ + σₜ²I)⁻¹ として表現される。これは周波数領域において、
各周波数成分のSNRに基づいて信号の保持度を決定する。

**主成分解析との関連**: データ共分散行列の固有分解 Σ = UΛU^T において、ウィーナーフィルターは
高固有値（高SNR）成分に対しては恒等変換に近く、低固有値成分に対しては強い減衰を示す。
これが、データ統計に依存した感度パターンの根拠となる。

**感度場の計算**: 各画素位置での感度は、ウィーナーフィルターの空間表現として計算される。
CIFAR10のような平行移動対称性の高いデータでは局所的パターンが現れ、CelebA-HQのような
構造化データでは顔の特徴間の長距離相関を反映した非局所的パターンが現れる。

**パッチベース最適デノイザーとの統合**: 従来のKamb-Ganguli手法では経験的に決定していた
マスクMₜᵠを、解析的に計算された感度場から直接導出する。これにより、従来手法の
主要な制限であったハイパーパラメータ調整の必要性を除去する。

**統計操作による検証**: 訓練データの画素統計を意図的に変更し、予測された感度パターンの変化を
実験的に検証する。これにより、感度場がアーキテクチャではなくデータ統計に由来することを
直接的に実証する。

### 2.3 新規性
本手法の新規性は、拡散モデル理論における根本的なパラダイムシフトにある。

**第一原理からの局所性導出**: 従来手法では、局所性を外部から与えられたアーキテクチャの
性質として扱っていたが、本研究では訓練データの統計から第一原理的に導出する。
これにより、なぜ特定のデータセットで特定の感度パターンが現れるかを定量的に予測可能となった。

**アーキテクチャ非依存性の実証**: Transformer等の明示的局所性バイアスを持たない
アーキテクチャでも同様の感度パターンが学習されることの理論的説明を提供する。
これは、局所性がアーキテクチャの制約ではなく、最適化の結果として自然に現れることを示している。

**線形性と非線形性の統合**: 拡散モデルの線形挙動の観察と、最適デノイザーの非線形性を
統一的に説明する理論的フレームワークを提供する。高SNR領域での線形的パススルーと
低SNR領域での非線形デノイジングの組み合わせとして、拡散モデルの挙動を理解する。

**完全解析的手法の実現**: 従来手法で必要だった経験的パラメータ調整を完全に排除し、
訓練データの統計のみから解析的に計算可能な拡散モデルを実現した。これにより、
理論と実践の橋渡しが大幅に改善された。

**統計操作による因果関係の実証**: データ統計の人工的操作により、感度パターンの変化を
制御可能であることを示し、データ統計と学習された感度の因果関係を直接実証した。

## 3. 実験結果
### 3.1 実験設定
実験は理論の検証と実用性の評価の二つの主要な目的で設計された。

**データセット**: CIFAR10（高自己類似性）、CelebA-HQ（構造化顔画像）、AFHQv2（動物顔）の
三つの代表的データセットを使用し、異なる統計的性質を持つデータでの理論の汎用性を検証した。

**ベースラインモデル**: 標準的なU-Net拡散モデルを各データセットで訓練し、学習された感度場を
感度解析により抽出した。これらを理論的に予測された感度場と定量的に比較した。

**評価指標**: 解析的モデルとニューラル拡散モデルの一致度を測定するため、感度場の相関係数、
生成画像のFID（Fréchet Inception Distance）スコア、および新たに導入した定量的ベンチマークを使用した。

**統計操作実験**: CIFAR10データセットにおいて、画素間の統計的相関を人工的に変更し、
予測された感度パターンの変化を検証する制御実験を実施した。

### 3.2 主要な結果
**感度場の予測精度**: CIFAR10において、理論的に予測された局所的感度パターンと実際に学習された
感度場の相関係数は0.89を達成した。CelebA-HQでは、目と口の間の長距離相関を含む非局所的パターンが
理論予測と0.83の相関を示し、データセットの構造的特性を正確に捕捉していることを実証した。

**解析的モデルの性能**: 新しく提案した統合モデルは、CIFAR10でFID 15.2、CelebA-HQでFID 28.7を達成し、
従来の最適デノイザーベースのKamb-Ganguli手法（FID 18.9, 34.2）を大幅に上回った。
驚くべきことに、単純なウィーナーフィルターでさえ従来手法より優れた性能（FID 17.1, 31.4）を示した。

**アーキテクチャ独立性の検証**: U-Net、ResNet、Transformerアーキテクチャで訓練された拡散モデルが
すべて類似の感度パターンを学習することを確認し、感度がアーキテクチャではなくデータに依存することを実証した。
相関係数は0.85-0.91の範囲で、アーキテクチャ間での高い一貫性を示した。

**統計操作実験の結果**: CIFAR10において、画素間の人工的相関導入により、理論予測通りの
非局所的感度パターンが学習されることを確認した。相関強度と感度の非局所性の間に
強い線形関係（R² = 0.94）が観察され、データ統計と学習パターンの因果関係を直接実証した。

### 3.3 既存手法との比較
**最適デノイザーベース手法との比較**: 従来のScarvelis et al.、Shah et al.等の平滑化ベース手法と比較して、
本手法は一貫してより良い性能を示した。特に、生成多様性の指標であるInception Score（IS）において、
本手法は従来手法を20-30%上回り、記憶化の回避と新規性の両立により優れていることを示した。

**経験的パラメータ調整手法との比較**: Kamb-Ganguli手法やNiedoba et al.手法が必要とする
経験的マスクフィッティングプロセスを完全に排除しながら、性能面では一貫した改善を達成した。
計算効率の観点でも、パラメータ探索が不要なため、約5倍の高速化を実現した。

**線形手法の予想外の優位性**: 最も注目すべき発見は、単純なウィーナーフィルターが
複雑な最適デノイザーベース手法を上回ったことである。これは、拡散モデルの核心的挙動が
データの線形統計によって支配されていることの強力な証拠となった。

**データセット横断での一貫性**: 三つの異なるデータセットすべてで一貫した改善が観察され、
手法の汎用性が実証された。特に、データセットの統計的性質の違いに応じて、
理論的に予測された通りの感度パターンの変化が観察されたことは、理論の妥当性を強く支持している。

## 4. 実用性評価
### 4.1 実装の容易性
本手法は理論的な洞察に重点を置いているが、実装面でも優れた特性を持っている。
解析的感度場の計算は、訓練データの共分散行列の固有分解という標準的な線形代数演算に基づいており、
既存の数値計算ライブラリ（NumPy、SciPy、MATLAB等）で容易に実装できる。

従来のKamb-Ganguli手法で必要だった、複数の候補マスクパターンに対する網羅的評価や、
訓練済みモデルに対する感度解析といった複雑な経験的手順を完全に排除している。
これにより、実装の複雑さが大幅に削減され、研究者は理論的理解に集中できる。

ウィーナーフィルターの計算は一度のデータセット解析で完了し、その結果は異なるモデルアーキテクチャや
ハイパーパラメータ設定にも適用可能である。これは、複数の実験設定での一貫した比較研究を
効率的に実施できることを意味する。

ただし、大規模データセットでの共分散行列計算は計算量とメモリ使用量の観点で課題となる可能性があり、
近似手法やサンプリングベースの推定が必要な場合がある。

### 4.2 計算効率
本手法の計算効率は従来手法と比較して大幅な改善を示している。最も重要な利点は、
経験的パラメータ探索プロセスの完全な排除である。従来手法では、異なるマスクサイズや形状に対して
反復的に性能評価を行う必要があったが、本手法では一度の統計解析で最適な感度場を決定できる。

**前処理段階**: データセットの共分散行列計算は O(n²d) の計算量（nは画素数、dは データ数）を要するが、
これは一度だけ実行される。大規模データセットでは、ランダムサンプリングやオンライン更新手法により
計算量を削減できる。

**推論段階**: 解析的感度場を使用した拡散サンプリングは、従来の数値的拡散モデルと同等の計算量で
実行できる。実際には、複雑な深層ネットワークの代わりに解析的演算を使用するため、
特定の用途では高速化も期待できる。

**メモリ効率**: 共分散行列の保存が必要だが、対称性や疎性を活用した効率的な表現により、
実用的な範囲内でのメモリ使用量に抑えられる。

実験結果では、従来手法と比較して約5倍の高速化を達成しており、これは主に
パラメータ探索の排除によるものである。

### 4.3 応用可能性
本研究の理論的フレームワークは、拡散モデルの理解と改良において広範囲な応用可能性を持つ。

**新しいアーキテクチャ設計**: データ統計から導出された最適感度場に基づいて、
特定のデータセットに特化した効率的なアーキテクチャを設計できる。これにより、
不要な計算を削減しながら性能を維持する軽量モデルの開発が可能となる。

**ドメイン適応**: 異なるドメインのデータセットでの拡散モデルの動作を事前に予測し、
転移学習やファインチューニング戦略を最適化できる。特に、医療画像や科学的データなど
特殊な統計的性質を持つドメインでの応用が期待される。

**解釈可能性の向上**: 学習された表現がデータのどの統計的側面を捉えているかを定量的に分析できるため、
拡散モデルの解釈可能性研究への応用が可能である。これは、AI の透明性が求められる
医療や法律分野での実用化において重要な意味を持つ。

**データ前処理の最適化**: データセットの統計的性質を分析することで、拡散モデルの性能を
最大化するデータ前処理手法を理論的に設計できる。これには、データ拡張戦略の最適化や
アクティブ学習での有効サンプル選択などが含まれる。

**生成制御の改良**: 感度場の理解により、生成プロセスのより精密な制御が可能となり、
条件付き生成や編集応用での品質向上が期待される。

## 5. まとめと所感
### 5.1 論文の意義
本論文は、拡散モデルの理論的理解における重要なブレークスルーを達成している。
最も重要な意義は、これまで「経験的」または「アーキテクチャ依存」と考えられていた局所性が、
実際には訓練データの統計的性質から自然に創発する現象であることを理論的・実証的に示したことにある。

この発見は、機械学習における帰納的バイアスの理解に対する根本的な再考を促す。
従来、ニューラルネットワークの設計において重要視されていたアーキテクチャの選択が、
実際にはデータの統計的性質によって決定される最適化の結果にすぎない可能性を示唆している。
これは、「アーキテクチャか、データか」という長年の議論に新しい視点を提供する。

理論的観点では、最適デノイザーの解析とウィーナーフィルター理論の接続により、
拡散モデルの挙動に対する統一的な理解を提供している。特に、線形性と非線形性の共存、
記憶化と汎化のトレードオフ、局所性と大域的一貫性のバランスなど、拡散モデルが示す
複雑な性質を単一の理論的フレームワークで説明できるようになった。

実用的観点では、完全に解析的な拡散モデルの実現により、従来は「ブラックボックス」だった
生成プロセスを理論的に制御可能にしている。これは、AI の説明可能性と制御可能性の向上に
大きく貢献する。

### 5.2 今後の展望
本研究は多くの将来的発展の可能性を開いている。理論的拡張として、より複雑なデータ分布
（非ガウス分布、多峰性分布、階層構造を持つ分布など）への理論の一般化が期待される。
現在の線形近似を超えた非線形統計量の活用により、さらに精密な感度場予測が可能になるだろう。

時系列や動画データへの拡張も重要な研究方向である。時間相関を含むデータの統計的性質から
時間的感度場を導出し、動画生成における時間的一貫性の理論的理解を深めることができる。
これは、次世代のビデオ生成モデルの理論的基盤となる可能性がある。

多次元・高次元データへの拡張により、3D形状生成、分子設計、科学的シミュレーションなど
より複雑なドメインでの拡散モデルの理論的理解も進展するだろう。特に、対称性や物理的制約を
持つデータでの統計的性質と学習パターンの関係の解明は、科学的発見支援AI の発展に寄与する。

実用的応用では、本理論に基づくアダプティブアーキテクチャの開発、データセット特化型
軽量モデルの自動生成、統計的性質に基づく生成品質の事前予測などが期待される。

また、本研究で確立された「データ統計から学習パターンを予測する」という一般的フレームワークは、
拡散モデルを超えて、他の生成モデルや識別モデルの理解にも適用可能である。
これにより、機械学習全体の理論的理解が深まることが予想される。

長期的には、本研究のアプローチが、人工知能システムの設計を「アーキテクチャ中心」から
「データ中心」へとシフトさせる契機となる可能性がある。データの統計的性質を深く理解し、
それに基づいて最適なモデル設計を行う新しいパラダイムの確立につながるだろう。
